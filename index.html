<html>
    <head>
        <title>Pet Depot</title>
        <script src="https://unpkg.com/vue"></script>
        <link rel="stylesheet" type="text/css" href="css/app.css">
        <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    </head>
    <body>
        <div id="app">
            <header>
                <div class="navbar navbar-default">
                    <div class="navbar-header">
                        <h1 v-text="title"></h1>
                    </div>
                    <div class="nav navbar-nav navbar-right cart">
                        <button class= "btn btn-default btn-lg" v-on:click="showCheckout">
                            <span class="glyphicon glyphicon-shopping-cart"> Checkout {{ cartItemCount }}</span>
                        </button>
                    </div>
                </div>
            </header>
            <main>
                <div class="row-product">
                    <div id="show" v-if="showProduct">
                        <div class="col">
                            <figure>
                                <img v-bind:src="product.image">
                            </figure>
                        </div>
                        <div class="col-expand">
                            <h1 v-text="product.title"></h1>
                            <p v-html="product.description"></p>
                            <p class="price">{{ product.price | formatPrice }}</p>
                            <button class="addBtn" id="addToCart" v-on:click="addToCart" v-if="canAddToCart">
                            Add to Cart</button>
                            <button id="disabled" v-else="disableButton">Add to Cart</button>
                            <button class="addBtn" v-on:click="emptyCart">Empty Cart</button>
                        </div>
                    </div>
                    <div v-else>

                    </div>
                </div>
            </main>
        </div>
        <script type="text/javascript">
            let webstore = new Vue({
                el: '#app',
                data: {
                    title: 'Pet Depot',
                    product: {
                        id: 1001,
                        title: "Cat Food, 25lb bag",
                        description: "A 25 pound bag of <em>irresistible</em>,"+
                        "organic goodness for your cat.",
                        price: 2000,
                        image: "images/product-fullsize.png",
                        availableInventory: 5
                    },
                    cart: [],
                    showProduct: true
                },
                filters: {
                    formatPrice(price) {
                        if (!parseInt(price)) return ""
                        if (price > 99999) {
                            let priceString = (price/100).toFixed(2)
                            let priceArray = priceString.split("").reverse()
                            let index = 3
                            while (priceArray.length > index + 3) {
                                priceArray.splice((index + 3), 0, "," )
                                index += 4
                            }
                            let formatted =  priceArray.reverse().join("")
                            return "$" + formatted
                        } else return "$" + (price/100).toFixed(2)
                    }
                },
                methods: {
                    addToCart() {
                        this.cart.push(this.product.id)
                    },
                    disableButton() {
                        document.getElementById('disabled').disable = true
                    },
                    showCheckout() {
                        this.showProduct = this.showProduct ? false : true
                    },
                    emptyCart() {
                        while(this.cart.length > 0) this.cart.pop()
                    }
                },
                computed: {
                    cartItemCount() {
                        return this.cart.length
                    },
                    canAddToCart() {
                        return this.product.availableInventory > this.cartItemCount
                    }
                }
            })
        </script>
    </body>
</html>